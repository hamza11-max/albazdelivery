[build]
  # Build the Next.js app. If DATABASE_URL is configured in the Netlify
  # environment, also run Prisma migrations against the production DB so the
  # deployed site has the correct schema. The shell guard prevents the migrate
  # step from running in contexts where DATABASE_URL is not set (e.g. forks/previews).
  #
  # Note: `npx prisma migrate deploy` runs migrations that were created with
  # `prisma migrate dev` / `prisma migrate` and should be used for production.
  command = "if [ -n \"$DATABASE_URL\" ]; then pnpm run build && npx prisma migrate deploy; else pnpm run build; fi"
  # Don't set publish - @netlify/plugin-nextjs handles it automatically

[build.environment]
  NODE_VERSION = "22"
  # Disable Next.js telemetry in CI
  NEXT_TELEMETRY_DISABLED = "1"

[[plugins]]
  package = "@netlify/plugin-nextjs"

# ⚠️ IMPORTANT: Environment Variables Required
# Go to: Netlify Dashboard → Site settings → Environment variables
# 
# Required variables (set these or deployment will fail):
# ┌──────────────────┬────────────────────────────────────────────────────┐
# │ Variable         │ Example Value                                      │
# ├──────────────────┼────────────────────────────────────────────────────┤
# │ NEXTAUTH_URL     │ https://main--albaz-dz.netlify.app                │
# │ NEXTAUTH_SECRET  │ jZa8K9xM2nP4vL6wQ8eR3tY5uI7oP1aS2dF4gH6jK8lZ   │
# │ DATABASE_URL     │ postgresql://user:pass@host/db?sslmode=require     │
# └──────────────────┴────────────────────────────────────────────────────┘
#
# Optional (for Google OAuth):
# - GOOGLE_CLIENT_ID
# - GOOGLE_CLIENT_SECRET
#
# 📖 Full setup guide: See NETLIFY_ENV_SETUP.md
