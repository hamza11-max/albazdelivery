(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[868],{"(app-pages-browser)/../../node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?modules=%7B%22request%22%3A%22E%3A%5C%5Cnn%5C%5Calbazdelivery%5C%5Capps%5C%5Ccustomer%5C%5Capp%5C%5Ccheckout%5C%5Ccheckout%5C%5Cclient.tsx%22%2C%22ids%22%3A%5B%22CheckoutPage%22%5D%7D&server=false!":(e,s,t)=>{Promise.resolve().then(t.bind(t,"(app-pages-browser)/./app/checkout/checkout/client.tsx"))},"(app-pages-browser)/./app/checkout/checkout/client.tsx":(e,s,t)=>{"use strict";t.r(s),t.d(s,{CheckoutPage:()=>l});var a=t("(app-pages-browser)/../../node_modules/next/dist/compiled/react/jsx-runtime.js"),r=t("(app-pages-browser)/../../node_modules/next/dist/compiled/react/index.js"),i=t("(app-pages-browser)/../../node_modules/@stripe/react-stripe-js/dist/react-stripe.esm.mjs"),n=t("(app-pages-browser)/../../packages/ui/src/index.ts"),o=t("(app-pages-browser)/__barrel_optimize__?names=Loader2!=!../../node_modules/lucide-react/dist/esm/lucide-react.js"),d=t("(app-pages-browser)/../../packages/shared/src/utils/index.ts");function l(e){let{order:s}=e,t=(0,i.useStripe)(),l=(0,i.useElements)(),[c,p]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!1),{toast:C}=(0,n.useToast)(),h=async e=>{if(e.preventDefault(),t&&l){p(!0);try{let e=await fetch("/api/payments/create-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:s.id,amount:s.total})}),{clientSecret:a}=await e.json();if(!a)throw Error("Payment failed to initialize");let{error:r,paymentIntent:n}=await t.confirmCardPayment(a,{payment_method:{card:l.getElement(i.CardElement)}});if(r)throw Error(r.message);"succeeded"===n.status&&C({title:"Paiement r\xe9ussi",description:"Votre commande a \xe9t\xe9 confirm\xe9e.",variant:"default"})}catch(e){console.error("Payment error:",e),C({title:"Erreur de paiement",description:e instanceof Error?e.message:"Une erreur s'est produite lors du paiement",variant:"destructive"})}finally{p(!1)}}};return(0,a.jsxs)(n.Card,{className:"w-full max-w-lg mx-auto",children:[(0,a.jsxs)(n.CardHeader,{children:[(0,a.jsx)(n.CardTitle,{children:"Paiement de commande"}),(0,a.jsx)(n.CardDescription,{children:"Entrez vos d\xe9tails de paiement pour finaliser votre commande."})]}),(0,a.jsx)(n.CardContent,{children:(0,a.jsxs)("form",{onSubmit:h,id:"payment-form",className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{children:"D\xe9tails de la carte"}),(0,a.jsx)(i.CardElement,{id:"card-element",className:"p-3 border rounded-md",onChange:e=>u(e.complete),options:{style:{base:{fontSize:"16px",fontSmoothing:"antialiased"}}},"data-testid":"card-number-input"})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{children:"Sous-total"}),(0,a.jsx)("span",{children:(0,d.formatPrice)(s.subtotal)})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{children:"Frais de livraison"}),(0,a.jsx)("span",{children:(0,d.formatPrice)(s.deliveryFee)})]}),(0,a.jsxs)("div",{className:"flex justify-between font-semibold",children:[(0,a.jsx)("span",{children:"Total"}),(0,a.jsx)("span",{children:(0,d.formatPrice)(s.total)})]})]})]})}),(0,a.jsx)(n.CardFooter,{children:(0,a.jsx)(n.Button,{type:"submit",form:"payment-form",className:"w-full",disabled:!t||!m||c,"data-testid":"pay-button",children:c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Traitement en cours..."]}):"Payer ".concat((0,d.formatPrice)(s.total))})})]})}}},e=>{e.O(0,[96,76,587,358],()=>e(e.s="(app-pages-browser)/../../node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?modules=%7B%22request%22%3A%22E%3A%5C%5Cnn%5C%5Calbazdelivery%5C%5Capps%5C%5Ccustomer%5C%5Capp%5C%5Ccheckout%5C%5Ccheckout%5C%5Cclient.tsx%22%2C%22ids%22%3A%5B%22CheckoutPage%22%5D%7D&server=false!")),_N_E=e.O()}]);